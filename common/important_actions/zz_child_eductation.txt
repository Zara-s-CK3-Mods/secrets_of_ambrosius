action_child_education_personality = {
	type = alert

	check_create_action = {
		every_courtier = {
			if = {
				limit = {
					root = {
						has_relation_ward = prev
						is_character_interaction_valid = {
							recipient = prev
							interaction = influence_child_personality_interaction
						}
					}
				}
				try_create_important_action = {
					important_action_type = action_child_education_personality
					actor = root
					recipient = this 
				}
			}	
		}
	}

	effect = {
		open_interaction_window = {
			interaction = influence_child_personality_interaction
			actor = scope:actor
			recipient = scope:recipient
		}
	}
}

action_child_education_commander = {
	type = alert

	check_create_action = {
		every_courtier = {
			if = {
				limit = {
					root = {
						has_relation_ward = prev
						is_character_interaction_valid = {
							recipient = prev
							interaction = influence_child_commander_interaction
						}
					}
				}
				try_create_important_action = {
					important_action_type = action_child_education_commander
					actor = root
					recipient = this 
				}
			}	
		}
	}

	effect = {
		open_interaction_window = {
			interaction = influence_child_commander_interaction
			actor = scope:actor
			recipient = scope:recipient
		}
	}
}


action_mana_generation_piety = {
	type = action
	combine_into_one = yes
	check_create_action = {
		if = {
			limit = {
				has_trait = zz_magister 
				var:piety_sacrifice ?= flag:true
			}
			try_create_important_action = {
				important_action_type = check_create_action
				actor = root
				recipient = this 
			}
		}	
		every_courtier = {
			if = {
				limit = {
					has_trait = zz_magister 
					var:piety_sacrifice ?= flag:true
				}
				try_create_important_action = {
					important_action_type = check_create_action
					actor = root
					recipient = this 
				}
			}	
		}
	}

	effect = {
		
	}
}
action_study_magic = {
	type = action
	combine_into_one = yes
	check_create_action = {
		always = no
				if = {
			limit = {
				has_trait = zz_magister 
				var:piety_sacrifice ?= flag:true
			}
			try_create_important_action = {
				important_action_type = check_create_action
				actor = root
				recipient = this 
			}
		}	
		every_courtier = {
			if = {
				limit = {
					has_trait = zz_magister 
					var:piety_sacrifice ?= flag:true
				}
				try_create_important_action = {
					important_action_type = check_create_action
					actor = root
					recipient = this 
				}
			}	
		}
	}

	effect = {
		if = { 
			limit = {
				NOT = {
					exists = var:zz_magic_ui
				}
			}
			
			custom_tooltip = order_scroll_learning_decision_effect_tooltip
			remove_variable = zz_magic_user
			remove_variable = zz_magic_ui
			remove_variable = learning_type
			save_scope_as = actor
			save_scope_as = zz_magic_user
			set_variable = {
				name = zz_magic_user
				value = scope:zz_magic_user
			}
			remove_variable = zz_magic_caster
			clear_variable_list = zz_valyria_spell_list
			if = {
				limit = {
					zz_valyria_is_mage = yes 
				}
				
				zz_valyria_make_magic_master_list = {MAGIC_USER = zz_magic_user}
				zz_valyria_make_magic_learner_list = {MAGIC_USER = zz_magic_user}
				
				zz_valyria_make_magic_mystery_master_list = {MAGIC_USER = zz_magic_user}
				zz_valyria_make_magic_mystery_learner_list = {MAGIC_USER = zz_magic_user}
				zz_valyria_make_magic_mystery_learner_not_mage_list = {MAGIC_USER = zz_magic_user}
				zz_valyria_make_magic_mystery_learner_mage_list = {MAGIC_USER = zz_magic_user}
				zz_valyria_make_master_spell_list = {MAGIC_USER = zz_magic_user MAGIC_TEACHER = zz_magic_mystery_master}	
				zz_valyria_make_mage_list =  {MAGIC_USER = zz_magic_user}
				zz_valyria_make_scroll_maker_list =  {MAGIC_USER = zz_magic_user}
				zz_valyria_make_scroll_maker_spell_list = {MAGIC_USER = zz_magic_user SCROLL_MAKER = zz_scroll_maker } 

			}
			if = { 
				limit = {
					zz_valyria_is_scroll_holder = yes 
				} 
				zz_setup_scroll_learning_lists = yes 
			}
			if = {
				limit = {
					zz_valyria_is_mage = yes 
					zz_valyria_can_become_apprentice = yes
					
				}
				set_variable = {
					name = learning_type
					value = flag:apprentice
				}
			}
			else_if = {
				limit = {
					zz_valyria_is_mage = yes 
				}
				set_variable = {
					name = learning_type
					value = flag:mystery
				}
			}
			else = {
				set_variable = {
					name = learning_type
					value = flag:scroll
				}
			}
			set_variable = {
				name = zz_magic_ui
				value = flag:scroll_learning
			}
		}
		else = {
			remove_variable = zz_magic_ui
		}
		set_variable = { 
			name = zz_magic_ui 
			value = flag:mages
		}
		set_variable = { 
			name = zz_magic_caster
			value = scope recipient
		}
	}
}