

zz_valyria_create_vs_sword_effect = {
	$OWNER$ = {
		save_scope_as = owner
	}
	var:zz_sword_selection_sword = { 
		save_scope_as = zz_sword_selection_sword
	}
	set_artifact_rarity_illustrious = yes
	if = { 
		limit = { 
			scope:zz_sword_selection_sword = flag:item_sword_01
		}
		create_artifact = {
			name = easteregg_artifact_jason_sword
			description = easteregg_artifact_jason_sword_description
			type = sword
			visuals = sword
			modifier = artifact_personal_scheme_phase_duration_add_10_modifier
			save_scope_as = newly_created_artifact
		}

		scope:newly_created_artifact ?= {
			add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
			equip_artifact_to_owner_replace = yes
			set_variable = {
				name = valyrian_steel
				value = yes
			}
			set_variable = {
				name = valyrian_steel_generic
				value = yes
			}
			set_variable = {
				name = valyrian_armingsword_silver_artifact
				value = yes
			}
			save_scope_value_as = {
				name = valyrian_steel
				value = yes
			}
		}
	}
	else_if = { 
		limit = { 
			scope:zz_sword_selection_sword = flag:item_sword_02
		}
		create_artifact = {
			name = easteregg_artifact_jason_sword
			description = easteregg_artifact_jason_sword_description
			type = sword
			visuals = longsword
			modifier = artifact_personal_scheme_phase_duration_add_10_modifier
			save_scope_as = newly_created_artifact
		}

		scope:newly_created_artifact ?= {
			add_artifact_modifier = artifact_owned_personal_scheme_success_chance_add_5_modifier
			equip_artifact_to_owner_replace = yes
			set_variable = {
				name = valyrian_steel
				value = yes
			}
			set_variable = {
				name = valyrian_steel_generic
				value = yes
			}
			set_variable = {
				name = valyrian_armingsword_silver_artifact
				value = yes
			}
			save_scope_value_as = {
				name = valyrian_steel
				value = yes
			}
		}
	}
	
	hidden_effect_new_object = {
		scope:newly_created_artifact = {
			add_artifact_history = { 
				location = scope:zz_item_crafter.location
				actor = scope:zz_item_crafter
				recipient = scope:owner
				type = created
			}
			clear_artifact_modifiers = yes
		}
	}
	set_variable = {
		name = newly_created_artifact
		value = scope:newly_created_artifact
	}
	zz_craft_item_apply_item_effect = {
		MODIFIER = zz_valyria_magic_vs_base_modifier_01_stacking
	}
	#zz_apply_item_magic_modifiers_effect = yes 
	trigger_event = zz_valyria_item_crafting_rename.2
}



zz_valyria_create_magic_ring_effect = {

	$OWNER$ = { save_scope_as = owner }
	set_artifact_rarity_illustrious = yes

	save_scope_value_as = {
		name = ring_modifier
		value = flag:$RING_MODIFIER$
	}
	create_artifact = {
		name = zz_valyria_artifact_mages_ring_name_dummy
		description = placeholder
		visuals = zz_valyria_ring
		type = ring
		creator = scope:zz_item_crafter
		history = {
			location = scope:zz_item_crafter.location
			actor = scope:zz_item_crafter
			recipient = scope:owner
			type = created
		}
		history = {
			location = scope:zz_item_crafter.location
			actor = scope:zz_item_crafter
			recipient = scope:owner
			type = created
		}
		template = zz_valyria_mages_ring_artifact_template
		modifier = item_modifier_11
		save_scope_as = newly_created_artifact
		wealth = scope:wealth
		quality = scope:quality
		decaying = no
	}
	set_variable = {
		name = newly_created_artifact
		value = scope:newly_created_artifact
	}
	scope:newly_created_artifact = {
		clear_artifact_modifiers = yes
		set_variable = {
			name = ring_modifier
			value = flag:$RING_MODIFIER$
		}
		set_artifact_name = zz_valyria_artifact_mages_ring_name
		set_artifact_description = zz_valyria_artifact_mages_ring_desc_dummy
		set_variable = {
			name = maesterwork
			value = yes
		}
		add_artifact_history = {
			type = given
			recipient = scope:owner
		}
		equip_artifact_to_owner_replace = yes
	}
	
	if = { 
		limit = {
			exists = scope:ring_modifier 
		}
		if = { 
			limit = {
				scope:ring_modifier ?= flag:drops_of_power
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_01
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:all_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_02
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:higher_mysteries
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_03
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:blood_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_04
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:shadow_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_05
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:dream_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_06
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:alchemy_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_07
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:fire_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_08
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:air_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_09
			}
		}
		if = { 
			limit = {
				scope:ring_modifier = flag:water_magic
			}
			zz_craft_item_apply_item_effect = {
				MODIFIER = item_modifier_10
			}
		}
	}
	trigger_event = zz_valyria_item_crafting_rename.2
}

zz_craft_item_apply_item_effect = {
	set_variable = { 
		name = zz_item_effect 
		value = flag:$MODIFIER$
	}
	if = {
		limit = {
			root = {
				var:zz_item_effect = flag:$MODIFIER$
			}
		}
		var:newly_created_artifact = {
			while = {
				count = root.zz_valyria_magic_alchemy_magic_crafting_value
				if = { 
					limit = { 
						root = {
							var:zz_item_effect = flag:item_modifier_11
						}
					}
					if = {
						limit = {
							exists = var:item_mana_gain
						}
						change_variable = {
							name = item_mana_gain
							add = 0.25
						}
					}
					else = {
						set_variable = {
							name = item_mana_gain
							value = 0.25
						}
					}
				}
				else_if = { 
					limit = { 
						root = {
							var:zz_item_effect = flag:item_modifier_01
						}
					}
					if = {
						limit = {
							exists = var:item_mana_gain_mult
						}
						change_variable = {
							name = item_mana_gain_mult
							add = 0.01
						}
					}
					else = {
						set_variable = {
							name = item_mana_gain_mult
							value = 0.01
						}
					}
				}
				else_if = { 
					limit = { 
						root = {
							var:zz_item_effect = flag:item_modifier_22
						}
					}
					if = {
						limit = {
							exists = var:item_mana_cap_add
						}
						change_variable = {
							name = item_mana_cap_add
							add = 5
						}
					}
					else = {
						set_variable = {
							name = item_mana_cap_add
							value = 5
						}
					}
				}
				add_artifact_modifier = $MODIFIER$
			}
		}
	}
}

zz_item_calculate_cost_effect = {
	if = {
		limit = {
			var:zz_selected_item ?= flag:$ITEM$
		}
		set_variable = {
			name = zz_current_cost_item
			value = $COST$
		}
	}
}
zz_modifier_calculate_effect = {
	if = {
		limit = {
			var:zz_selected_modifier ?= flag:$MODIFIER$
		}
		set_variable = {
			name = zz_current_cost_modifier
			value = $COST$
		}
	}
}


zz_item_craft_item_sword = {
	zz_valyria_create_vs_sword_effect = {OWNER = root} 
	zz_apply_item_magic_modifiers_effect = yes 
	
}
zz_item_craft_item_bow = {
	create_artifact_bow_effect = { 
		OWNER = root
		CREATOR = root
		SET_BOW_TYPE = flag:artifact_bow_type_composite 
	}
	set_variable = {
		name = newly_created_artifact
		value = scope:newly_created_artifact
	}
	zz_apply_item_magic_modifiers_effect = yes 
}

zz_item_craft_item_armour = {
	create_artifact_armor_effect = {
		OWNER = root
		CREATOR = root
		SET_ARMOR_TYPE = flag:no
	}
	set_variable = {
		name = newly_created_artifact
		value = scope:newly_created_artifact
	}
	zz_apply_item_magic_modifiers_effect = yes 
}

zz_item_craft_item_ring = {
	debug_log = "craft ring"
	if = { 
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_01
		}
		debug_log = "make ring of power"
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = drops_of_power   }
		
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_02
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = blood_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_03
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = shadow_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_04
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = dream_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_05
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = alchemy_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_06
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = fire_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_07
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = air_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_08
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = water_magic   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_09
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = higher_mysteries   }
	}
	else_if = {
		limit = {
			var:zz_ring_selection_ring = flag:item_ring_10
		}
		zz_valyria_create_magic_ring_effect ={ OWNER = root RING_MODIFIER = all_magic   }
	}
	zz_apply_item_magic_modifiers_effect = yes 
	
}


zz_craft_item_effect = {
	if = {
		limit = {
			var:zz_selected_item = flag:$ITEM$
		}
		random_list = { 
			65 = { 
				modifier = {
					add = zz_spellcast_value
				}
				zz_item_craft_$ITEM$ = yes 
			}
			35 = { 
				zz_valyria_spell_failure_effect = yes
			}
		}
	}
}

zz_craft_item_apply_modifier_effect = {
	if = {
		limit = {
			root = {
				var:zz_selected_modifier = flag:$MODIFIER$
			}
		}
		var:newly_created_artifact = {
			while = {
				count = root.zz_valyria_magic_alchemy_magic_crafting_value
				if = { 
					limit = { 
						root = {
							var:zz_selected_modifier = flag:item_modifier_11
						}
					}
					if = {
						limit = {
							exists = var:item_mana_gain
						}
						change_variable = {
							name = item_mana_gain
							add = 0.25
						}
					}
					else = {
						set_variable = {
							name = item_mana_gain
							value = 0.25
						}
					}
				}
				else_if = { 
					limit = { 
						root = {
							var:zz_selected_modifier = flag:item_modifier_01
						}
					}
					if = {
						limit = {
							exists = var:item_mana_gain_mult
						}
						change_variable = {
							name = item_mana_gain_mult
							add = 0.01
						}
					}
					else = {
						set_variable = {
							name = item_mana_gain_mult
							value = 0.01
						}
					}
				}
				else_if = { 
					limit = { 
						root = {
							var:zz_selected_modifier = flag:item_modifier_22
						}
					}
					if = {
						limit = {
							exists = var:item_mana_cap_add
						}
						change_variable = {
							name = item_mana_cap_add
							add = 5
						}
					}
					else = {
						set_variable = {
							name = item_mana_cap_add
							value = 5
						}
					}
				}
				add_artifact_modifier = $MODIFIER$
			}
		}
	}
}

zz_valyria_crafting_calculate_crafting_cost_item_effect = {
	zz_item_calculate_cost_effect = {
		ITEM = item_none
		COST = zz_no_modifer_cost
	}
	
	zz_item_calculate_cost_effect = {
		ITEM = item_sword
		COST = zz_item_vs_sword_cost
	}
	zz_item_calculate_cost_effect = {
		ITEM = item_bow
		COST = zz_item_dragonbone_bow_cost
	}
	zz_item_calculate_cost_effect = {
		ITEM = item_armour
		COST = zz_item_vs_armour_cost
	}

	zz_item_calculate_cost_effect = {
		ITEM = item_ring
		COST = zz_item_vs_ring_cost
	}	
	zz_item_calculate_cost_effect = {
		ITEM = item_glass_candle
		COST = zz_item_glass_candle_cost
	}
	zz_item_calculate_cost_effect = {
		ITEM = item_dragon_horn
		COST = zz_item_dragon_horn_cost
	}
}

zz_valyria_crafting_calculate_crafting_cost_modifier_effect = {
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_01
		COST = zz_no_modifer_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_02
		COST = zz_modifier_dop_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_03
		COST = zz_modifier_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_04
		COST = zz_modifier_higher_mysteries_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_04
		COST = zz_modifier_blood_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_05
		COST = zz_modifier_shadow_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_06
		COST = zz_modifier_dream_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_07
		COST = zz_modifier_alchemy_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_08
		COST = zz_modifier_fire_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_09
		COST = zz_modifier_air_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_10
		COST = zz_modifier_water_magic_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_11
		COST = zz_modifier_passive_dop_xp_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_12
		COST = zz_modifier_learning_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_13
		COST = zz_modifier_diplomacy_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_14
		COST = zz_modifier_stewardship_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_15
		COST = zz_modifier_martial_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_16
		COST = zz_modifier_intrigue_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_17
		COST = zz_modifier_prowess_add_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_18
		COST = zz_modifier_diplomacy_range_mult_cost
	}

	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_19
		COST = zz_modifier_diplomacy_range_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_20
		COST = zz_modifier_diplomacy_range_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_21
		COST = zz_modifier_diplomacy_range_mult_cost
	}
	zz_modifier_calculate_effect = {
		MODIFIER = item_modifier_22
		COST = zz_modifier_diplomacy_range_mult_cost
	}
}

zz_valyria_crafting_item_construct_effect = {
	if = {
		limit = {
			var:zz_selected_item = flag:item_sword
		}
		zz_craft_item_effect = {
			ITEM = item_sword
		} 
	}

	else_if = {
		limit = {
			var:zz_selected_item = flag:item_bow
		}
		zz_craft_item_effect = {
			ITEM = item_bow
		}
	}
	else_if = {
		limit = {
			var:zz_selected_item = flag:item_armour
		}
		zz_craft_item_effect = {
			ITEM = item_armour
		}
	}
	else_if = {
		limit = {
			var:zz_selected_item = flag:item_ring
		}
		zz_craft_item_effect = {
			ITEM = item_ring
		}
	}
}



zz_apply_item_magic_modifiers_effect = {
	switch = {
		trigger = var:zz_selected_modifier 
		flag:item_modifier_01 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_01
			}
		}
		flag:item_modifier_02 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_02
			}
		}
		flag:item_modifier_03 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_03
			}
		}
		flag:item_modifier_04 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_04
			}
		}
		flag:item_modifier_05 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_05
			}
		}
		flag:item_modifier_06 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_06
			}
		}
		flag:item_modifier_07 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_07
			}
		}
		flag:item_modifier_08 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_08
			}
		}
		flag:item_modifier_09 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_09
			}
		}
		flag:item_modifier_10 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_10
			}
		}
		flag:item_modifier_11 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_11
			}
		}
		flag:item_modifier_12 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_12
			}
		}
		flag:item_modifier_13 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_13
			}
		}
		flag:item_modifier_14 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_14
			}
		}
		flag:item_modifier_15 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_15
			}
		}
		flag:item_modifier_16 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_16
			}
		}
		flag:item_modifier_17 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_17
			}
		}
		flag:item_modifier_18 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_18
			}
		}
		flag:item_modifier_19 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_19
			}
		}
		flag:item_modifier_20 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_20
			}
		}
		flag:item_modifier_21 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_21
			}
		}
		flag:item_modifier_22 = {
			zz_craft_item_apply_modifier_effect = {
				MODIFIER = item_modifier_22
			}
		}

	}
	
	
}


zz_craft_item_cost_effect = {
	if = {
		limit = {
			var:zz_current_magic_reagent ?= flag:mages_power
		}
		var:zz_item_crafter ?= {
			set_variable = {
				name = zz_manacost 
				value = zz_valyria_mana_cost
			}
			zz_valyria_mana_spend = yes
		}
	}
	if = {
		limit = {
			var:zz_current_magic_reagent ?= flag:human_sacrifice
		}
		trigger_event = zz_valyria_item_crafting_human_sacrifice.01 
	}
	remove_short_term_gold = zz_valyria_current_cost


}